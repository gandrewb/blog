$m-start: 550px;
$l-start: 850px;

$breakpoints: (
	's': (0, $m-start - 1),
	'm': ($m-start, $l-start - 1),
	'l': ($l-start, 'inf')
);

@mixin viewport($args...){
	$queries: query_list($args);
	$queries: combine_queries($queries);
	$media_query: build_query($queries);
	
	@media #{$media_query} {
		@content;
	}
}

@function build_query($qs){
	$q: 'screen';
	
	@for $i from 1 through length($qs){
		$q: $q + if($i!=1, ', screen', '');
		
		@if map-get(nth($qs, $i), 'min') != 0{
			$q: $q + ' and (min-width: #{map-get(nth($qs, $i), "min")})';
		}
		@if map-get(nth($qs, $i), 'max') != 'inf'{
			$q: $q + ' and (max-width: #{map-get(nth($qs, $i), "max")})';
		}
	}
	@return $q;
}

@function query_list($args){
	$newqueries: ();
	
	@for $i from 1 through length($args){
		$min: nth(map-get($breakpoints, nth($args, $i)),1);
		$max: nth(map-get($breakpoints, nth($args, $i)),2);
		
		$newqueries: append($newqueries, ('min': $min, 'max': $max));
	}
	
	@return $newqueries;
}

@function combine_queries($quer){
	@for $x from length($quer) through 1{
		@if length($quer) > 1{
			@for $y from length($quer)-1 through 1{
				$xval: nth($quer, $x);
				$yval: nth($quer, $y);
				
				$test_pos: test_queries($xval, $yval);
				
				@if $test_pos != 0 {
					$min: null; $max: null;
					@if $test_pos==1 {
						$min: map-get($yval, 'min');
						$max: map-get($xval, 'max');
					}@else{
						$min: map-get($xval, 'min');
						$max: map-get($yval, 'max');
					}
					
					$quer: set-nth($quer, $y, ('min': $min, 'max': $max));
					$quer: remove-nth($quer, $x);
				}
			}
		}
	}

	@return $quer;
}

//whether $q_a goes before (-1) or after (1) $q_b. Or neither (0)
@function test_queries($q_a, $q_b){	
	@if map-get($q_a, 'min') == (map-get($q_b, 'max')+1){
		@return 1;
	}
	@else if map-get($q_a, 'max') == (map-get($q_b, 'min')-1){
		@return -1;
	}
	@else{
		@return 0;
	}
}

@function remove-nth($list, $index) {
  $result: null;
        
  @if type-of($index) != number {
    @warn "$index: #{quote($index)} is not a number for `remove-nth`.";
  }

  @else if $index == 0 {
    @warn "List index 0 must be a non-zero integer for `remove-nth`.";
  }

  @else if abs($index) > length($list) {
    @warn "List index is #{$index} but list is only #{length($list)} item long for `remove-nth`.";
  }

  @else {
    $result: ();
    $index: if($index < 0, length($list) + $index + 1, $index);  

    @for $i from 1 through length($list) {
      @if $i != $index {
        $result: append($result, nth($list, $i));
      }
    }
  }
        
  @return $result;
}